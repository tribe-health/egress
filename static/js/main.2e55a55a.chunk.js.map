{"version":3,"sources":["SpeakerLayout.module.css","GridLayout.tsx","SpeakerLayout.tsx","Room.tsx","App.tsx","index.tsx","GridLayout.module.css"],"names":["module","exports","GridLayout","participants","room","React","useState","visibleParticipants","setVisibleParticipants","styles","grid1x1","gridClass","setGridClass","useEffect","numVisible","length","grid2x1","grid2x2","grid3x3","grid4x4","grid5x5","Math","min","newParticipants","forEach","p","has","sid","localParticipant","push","activeSpeakers","speaker","includes","idx","findIndex","isSpeaking","splice","className","stage","map","participant","orientation","width","height","identity","SpeakerLayout","screenTrack","otherParticipants","mainView","remoteParticipants","filter","RemoteParticipant","pub","getTrack","Track","Source","ScreenShare","isSubscribed","videoTrack","track","slice","stageCenter","stageSidebar","RoomPage","url","token","initialLayout","layout","setLayout","roomState","useRoom","adaptiveStream","audioTracks","connect","EgressHelper","setRoom","autoEnd","onLayoutChanged","newLayout","startRecording","Stage","hasScreenShare","setHasScreenShare","found","isScreenShareEnabled","interfaceStyle","main","containerClass","startsWith","isLocal","App","getLiveKitURL","getAccessToken","getLayout","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.2e55a55a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"stage\":\"SpeakerLayout_stage__25205\",\"stageCenter\":\"SpeakerLayout_stageCenter__2UqBp\",\"stageSidebar\":\"SpeakerLayout_stageSidebar__WeIBE\"};","import { ParticipantView } from '@livekit/react-components';\nimport { Participant } from 'livekit-client';\nimport React, { useEffect } from 'react';\nimport {\n  LayoutProps,\n} from './common';\nimport styles from './GridLayout.module.css';\n\nconst GridLayout = ({ participants, room }: LayoutProps) => {\n  const [visibleParticipants, setVisibleParticipants] = React.useState<Participant[]>([]);\n  const [gridClass, setGridClass] = React.useState(styles.grid1x1);\n\n  // select participants to display on first page, keeping ordering consistent if possible.\n  useEffect(() => {\n    let numVisible = participants.length;\n    if (participants.length === 1) {\n      setGridClass(styles.grid1x1);\n    } else if (participants.length === 2) {\n      setGridClass(styles.grid2x1);\n    } else if (participants.length <= 4) {\n      setGridClass(styles.grid2x2);\n    } else if (participants.length <= 9) {\n      setGridClass(styles.grid3x3);\n    } else if (participants.length <= 16) {\n      setGridClass(styles.grid4x4);\n    } else {\n      setGridClass(styles.grid5x5);\n      numVisible = Math.min(numVisible, 25);\n    }\n\n    // remove any participants that are no longer connected\n    const newParticipants: Participant[] = [];\n    visibleParticipants.forEach((p) => {\n      if (\n        room?.participants.has(p.sid)\n        || room?.localParticipant.sid === p.sid\n      ) {\n        newParticipants.push(p);\n      }\n    });\n\n    // ensure active speakers are all visible\n    room?.activeSpeakers?.forEach((speaker) => {\n      if (\n        newParticipants.includes(speaker)\n        || (speaker !== room?.localParticipant\n          && !room?.participants.has(speaker.sid))\n      ) {\n        return;\n      }\n      // find a non-active speaker and switch\n      const idx = newParticipants.findIndex((p) => !p.isSpeaking);\n      if (idx >= 0) {\n        newParticipants[idx] = speaker;\n      } else {\n        newParticipants.push(speaker);\n      }\n    });\n\n    // add other non speakers\n    for (const p of participants) {\n      if (newParticipants.length >= numVisible) {\n        break;\n      }\n      if (newParticipants.includes(p) || p.isSpeaking) {\n        continue;\n      }\n      newParticipants.push(p);\n    }\n\n    if (newParticipants.length > numVisible) {\n      newParticipants.splice(numVisible, newParticipants.length - numVisible);\n    }\n    setVisibleParticipants(newParticipants);\n  }, [participants]);\n\n  if (visibleParticipants.length === 0) {\n    return <div />;\n  }\n\n  return (\n    <div className={`${styles.stage} ${gridClass}`}>\n      {visibleParticipants.map((participant) => (\n        <ParticipantView\n          key={participant.identity}\n          participant={participant}\n          orientation=\"landscape\"\n          width=\"100%\"\n          height=\"100%\"\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default GridLayout;\n","import { ParticipantView, ScreenShareView } from '@livekit/react-components';\nimport {\n  Participant, RemoteParticipant, RemoteVideoTrack, Track,\n} from 'livekit-client';\nimport React, { ReactElement } from 'react';\nimport { LayoutProps } from './common';\nimport styles from './SpeakerLayout.module.css';\n\nconst SpeakerLayout = ({ participants }: LayoutProps) => {\n  // find first participant with screen shared\n  let screenTrack: RemoteVideoTrack | undefined;\n  const remoteParticipants = participants.filter((p) => (p instanceof RemoteParticipant));\n  remoteParticipants.forEach((p) => {\n    const pub = p.getTrack(Track.Source.ScreenShare);\n    if (pub && pub.isSubscribed) {\n      screenTrack = pub.videoTrack as RemoteVideoTrack;\n    }\n  });\n\n  if (remoteParticipants.length === 0) {\n    return <div />;\n  }\n\n  // full screen a single participant\n  if (remoteParticipants.length === 1 && !screenTrack) {\n    return (\n      <>\n        <ParticipantView\n          participant={remoteParticipants[0]}\n          width=\"100%\"\n          height=\"100%\"\n          orientation=\"landscape\"\n        />\n      </>\n    );\n  }\n\n  let otherParticipants: Participant[];\n  let mainView: ReactElement;\n  if (screenTrack) {\n    otherParticipants = remoteParticipants;\n    mainView = (\n      <ScreenShareView track={screenTrack} height=\"100%\" width=\"100%\" />\n    );\n  } else {\n    otherParticipants = remoteParticipants.slice(1);\n    mainView = (\n      <ParticipantView\n        key={remoteParticipants[0].identity}\n        participant={remoteParticipants[0]}\n        width=\"100%\"\n        height=\"100%\"\n        orientation=\"landscape\"\n      />\n    );\n  }\n\n  return (\n    <div className={styles.stage}>\n      <div className={styles.stageCenter}>{mainView}</div>\n      <div className={styles.stageSidebar}>\n        {otherParticipants.map((participant) => (\n          <ParticipantView\n            key={participant.identity}\n            participant={participant}\n            width=\"100%\"\n            height=\"100%\"\n            orientation=\"landscape\"\n          />\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default SpeakerLayout;\n","import EgressHelper from '@livekit/egress-sdk';\nimport { AudioRenderer, useRoom } from '@livekit/react-components';\nimport {\n  AudioTrack, Participant, RemoteParticipant, Room,\n} from 'livekit-client';\nimport React, { ReactElement, useEffect, useState } from 'react';\nimport GridLayout from './GridLayout';\nimport SpeakerLayout from './SpeakerLayout';\n\ninterface RoomPageProps {\n  url: string;\n  token: string;\n  layout: string;\n}\n\nexport default function RoomPage({ url, token, layout: initialLayout }: RoomPageProps) {\n  const [layout, setLayout] = useState(initialLayout);\n  const roomState = useRoom({\n    adaptiveStream: true,\n  });\n  const { room, participants, audioTracks } = roomState;\n\n  useEffect(() => {\n    roomState.connect(url, token);\n  }, [url]);\n\n  useEffect(() => {\n    if (room) {\n      EgressHelper.setRoom(room, {\n        autoEnd: true,\n      });\n      // Egress layout can change on the fly, we can react to the new layout\n      // here.\n      EgressHelper.onLayoutChanged((newLayout) => {\n        setLayout(newLayout);\n      });\n\n      // start recording immediately after connection\n      EgressHelper.startRecording();\n    }\n  }, [room]);\n\n  if (!url || !token) {\n    return <div className=\"error\">missing required params url and token</div>;\n  }\n\n  // not ready yet, don't render anything\n  if (!room) {\n    return <div />;\n  }\n\n  // filter out local participant\n  const remoteParticipants = participants.filter((p) => p instanceof RemoteParticipant);\n\n  return (\n    <Stage\n      layout={layout}\n      room={room}\n      participants={remoteParticipants}\n      audioTracks={audioTracks}\n    />\n  );\n}\n\ninterface StageProps {\n  layout: string;\n  room: Room;\n  participants: Participant[];\n  audioTracks: AudioTrack[];\n}\n\nfunction Stage({\n  layout, room, participants, audioTracks,\n}: StageProps) {\n  const [hasScreenShare, setHasScreenShare] = useState(false);\n\n  useEffect(() => {\n    let found = false;\n    for (const p of participants) {\n      if (p.isScreenShareEnabled) {\n        found = true;\n      }\n    }\n    setHasScreenShare(found);\n  }, [participants]);\n\n  let interfaceStyle = 'light';\n  if (layout === 'speaker-dark' || layout === 'grid-dark') {\n    interfaceStyle = 'dark';\n  }\n\n  let containerClass = 'roomContainer';\n  if (interfaceStyle) {\n    containerClass += ` ${interfaceStyle}`;\n  }\n\n  // determine layout to use\n  let main: ReactElement;\n  if (layout.startsWith('speaker') || hasScreenShare) {\n    main = (\n      <SpeakerLayout\n        room={room}\n        participants={participants}\n      />\n    );\n  } else {\n    main = (\n      <GridLayout\n        room={room}\n        participants={participants}\n      />\n    );\n  }\n\n  return (\n    <div className={containerClass}>\n      {main}\n      {audioTracks.map((track) => (\n        <AudioRenderer key={track.sid} track={track} isLocal={false} />\n      ))}\n    </div>\n  );\n}\n","import EgressHelper from '@livekit/egress-sdk';\nimport '@livekit/react-components/dist/index.css';\nimport React from 'react';\nimport 'react-aspect-ratio/aspect-ratio.css';\nimport './App.css';\nimport RoomPage from './Room';\n\nfunction App() {\n  return (\n    <div className=\"container\">\n      <RoomPage\n        // EgressHelper retrieves parameters passed to the page\n        url={EgressHelper.getLiveKitURL()}\n        token={EgressHelper.getAccessToken()}\n        layout={EgressHelper.getLayout()}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport './index.css';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root'),\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"stage\":\"GridLayout_stage__30DlR\",\"grid1x1\":\"GridLayout_grid1x1__3aEAn\",\"grid2x1\":\"GridLayout_grid2x1__2Ba_1\",\"grid2x2\":\"GridLayout_grid2x2__2f_nY\",\"grid3x3\":\"GridLayout_grid3x3__170FX\",\"grid4x4\":\"GridLayout_grid4x4__2G9kX\",\"grid5x5\":\"GridLayout_grid5x5__Iw6qK\"};"],"sourceRoot":""}